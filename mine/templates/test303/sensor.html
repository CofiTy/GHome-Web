{% extends "test303/base.html" %}

{%block js%}
<script src="/media/highcharts/js/highcharts.js" type="text/javascript"></script>

<script type="text/javascript">
    var chart;
$(document).ready( function() {
    //Set crumbs
    $('.nav').each( function() {
	$(this).removeClass("active");
    });
    $('#sensors').addClass("active");


    //Automatic updates
    var intervalID = window.setInterval( function () {
	console.log("go !");
	$.ajax({
	    url: 'json',
	    success: function(data) {
		console.log('-json' + data.value);
		$('#value').html(data.value);
		chart.series[0].addPoint({x:Date.now(), y: data.value} ,
					 true, 
					 chart.series[0].data.length > 20);
	    },
	    error: function(request, errStr, error) {
		console.log(errStr);
	    },
	    dataType: 'json',
	});
    }, 5000);

    //Set up graph
    chart = new Highcharts.Chart({
        chart: {
	    renderTo: 'container',
	    defaultSeriesType: 'area',
        },
        title: {
	    text: '{{type}} du capteur {{sensor.name}}'
        },
        xAxis: {
	    type: 'datetime',
	    tickPixelInterval: 150,
	    maxZoom: 20 * 1000
        },
        yAxis: {
	    minPadding: 0.2,
	    maxPadding: 0.2,
	    title: {
                text: '{{type}}',
                margin: 80
	    }
        },
        series: [{
	    name: '{{sensor.name}}',
	    data: []
        }]
    });
})
</script>
{%endblock%}

{% block breadcrumb %}
<li><a href="/home">Home</a> <span class="divider">/</span></li>
<li><a href="/sensors">Sensors</a> <span class="divider">/</span></li>
<li class="active">sensor</li>
{% endblock %}

{% block content %}
<div class="page-header">
  <h1>Summary</h1>
</div>
<dl>
    <dt>{{ sensor.name }}</dt>
    <dd>Value : <span id="value">{{ sensor.value }}</span></dd>
</dl>
<div class="page-header">
  <h1>Live Graph</h1>
</div>
<div id="container" style="width: 100%; height: 400px"></div>
{% endblock %}
